# Исправление проблемы "сервер не находится" после рефакторинга

## Проблема

После рефакторинга сервер запущен на порту **8001**, но бот пытается подключиться к другому порту.

## Решение

### 1. Проверьте текущий `.env` файл

```bash
cat .env | grep SERVER_URL
cat .env | grep PORT
```

### 2. Обновите `.env` файл

Убедитесь, что в `.env` файле правильно указан `SERVER_URL`:

```bash
# Для случая, когда бот и сервер на одном сервере:
SERVER_URL=http://127.0.0.1:8001

# Или если бот на другой машине (замените на ваш IP):
SERVER_URL=http://ВАШ_IP_СЕРВЕРА:8001
```

### 3. Убедитесь, что порт совпадает

В `.env` должно быть:
```bash
PORT=8001
SERVER_URL=http://127.0.0.1:8001
```

### 4. Перезапустите бота

```bash
./stop_all.sh
./start_all.sh
```

### 5. Проверьте подключение

```bash
# Проверить, что сервер слушает правильный порт
tail -f server.log

# Проверить логи бота
tail -f bot.log
```

### 6. Протестируйте команду /status в боте

Команда `/status` покажет, может ли бот подключиться к серверу.

## Если бот на другой машине

Если Telegram бот запущен на другом сервере (не на том же, где FastAPI):

1. Убедитесь, что порт 8001 открыт в firewall
2. Используйте внешний IP сервера вместо 127.0.0.1
3. В `.env` файле на машине с ботом укажите:
   ```bash
   SERVER_URL=http://ВАШ_ВНЕШНИЙ_IP:8001
   ```

## Быстрая проверка

```bash
# Проверить, на каком порту запущен сервер
ps aux | grep uvicorn

# Проверить, что порт слушается
netstat -tlnp | grep 8001
# или
ss -tlnp | grep 8001

# Проверить доступность сервера
curl http://127.0.0.1:8001/health
```
